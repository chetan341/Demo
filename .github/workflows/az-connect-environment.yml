name: Run Set env

on: 
  workflow_dispatch:
    inputs:
      businessEnvironment:
        description: 'ADLS Environment'
        type: choice
        default: 'Non-Prod'
        options:
         - Prod
         - Non-Prod
        required: true

     
jobs:  
  Windows-latest:
      runs-on: windows-latest
      
      steps:
       
           - name: Set environments values
             run: |
                   if ($env_code -eq 'Non-Prod' ){
                       Write-Output 'Non prod'
                       $envs = @('dev','tst','pre')
                       echo "parameters.envs.value=$envs" >> "$GITHUB_ENV"
                   }
                   else{
                       Write-Output 'prod'
                       $envs = @('prd')
                       echo "parameters.envs.value=$envs" >> "$GITHUB_ENV"
                   }
             env:
               env_code: ${{github.event.inputs.businessEnvironment}}
          
          
           - name: 'Get env'                    
             shell: pwsh
             run: |                         
                    $sgObjects = ${env:parameters.envs.value}
                    Write-Output $sgObjects.GetType()               
                    Write-Output $sgObjects

                    foreach ($item in $sgObjects){
                        Write-Output $item.SecurityGroup
                        $item.SecurityGroup | ConvertTo-Json -Depth 5
                      }
